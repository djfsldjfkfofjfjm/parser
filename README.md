# Веб-парсер

Веб-приложение для парсинга и анализа сайтов. Позволяет получать структуру сайта, извлекать контент и обрабатывать его с помощью технологии Google Gemini.

## Функциональность

- Сканирование структуры веб-сайта
- Извлечение контента из выбранных страниц
- Обработка и анализ полученного контента
- Создание базы знаний на основе контента сайта
- Кэширование результатов для повторного использования

## Структура проекта

```
.
├── index.html           # Основной HTML файл приложения
├── style.css            # Стили приложения
├── js/                  # Директория JavaScript файлов
│   ├── main.js          # Основной модуль приложения
│   ├── api/             # API-интерфейсы
│   │   ├── api.js       # Модуль для работы с внешними API
│   │   ├── config.js    # Файл с конфигурацией API-ключей
│   │   └── index.js     # Экспорт API функций
│   ├── services/        # Сервисы приложения
│   │   ├── category-parser.js     # Парсинг категорий сайта
│   │   ├── page-title-service.js  # Получение заголовков страниц
│   │   ├── title-extractor.js     # Извлечение заголовков из HTML
│   │   ├── tree-manager.js        # Управление деревом URL
│   │   ├── url-tree-builder.js    # Построение дерева URL-адресов
│   │   └── index.js               # Экспорт сервисных функций
│   └── utils/           # Утилитарные модули
│       ├── cache-manager.js    # Управление кэшированием
│       ├── debug.js            # Инструменты отладки
│       ├── ui-utils.js         # Утилиты для работы с интерфейсом
│       ├── tree/               # Модули работы с деревом URL
│       │   ├── data-builder.js       # Построение данных дерева
│       │   ├── dom-handlers.js       # Обработчики DOM-элементов дерева
│       │   ├── tree-operations.js    # Операции с деревом
│       │   ├── tree-initializer.js   # Инициализация дерева
│       │   └── index.js              # Экспорт функций дерева
│       └── index.js            # Экспорт утилит
├── .gitignore           # Файлы, исключаемые из Git
├── vercel.json          # Конфигурация для деплоя на Vercel
└── README.md            # Документация проекта
```

## Использование

1. Откройте `index.html` в браузере
2. Введите URL сайта и нажмите "Начать"
3. Выберите страницы для анализа
4. Нажмите "Анализировать выбранные"
5. Используйте полученные результаты

### Режим отладки

Для активации режима отладки добавьте параметр `debug` к URL:
```
http://localhost/index.html?debug
```

В режиме отладки появятся дополнительные кнопки для инспекции дерева URL и отладки выбора.

## Зависимости

- jQuery
- jsTree (для визуализации дерева URL) 

## Настройка API ключей

Перед использованием приложения необходимо настроить API ключи:

1. Скопируйте файл `js/api/config.example.js` в `js/api/config.js`
2. Замените placeholder значения на действительные API ключи:
   ```javascript
   const FIRECRAWL_API_KEY = 'your-firecrawl-api-key';
   const GEMINI_API_KEY = 'your-gemini-api-key';
   ```

## Деплой

Проект можно развернуть на различных платформах. Ниже приведены подробные инструкции для деплоя на Vercel через GitHub.

### Деплой на Vercel через GitHub

1. **Подготовка кода**:
   - Настройте API ключи в файле `js/api/config.js`
   - Убедитесь, что проект работает локально
   - Файл `config.js` уже настроен для использования переменных окружения:
     ```javascript
     const FIRECRAWL_API_KEY = process.env.FIRECRAWL_API_KEY || 'your-firecrawl-api-key';
     const GEMINI_API_KEY = process.env.GEMINI_API_KEY || 'your-gemini-api-key';
     ```

2. **Создание репозитория на GitHub**:
   - Создайте новый репозиторий на [GitHub](https://github.com/new)
   - Инициализируйте Git в проекте: `git init`
   - Добавьте удаленный репозиторий: `git remote add origin https://github.com/username/web-parser-app.git`
   - Добавьте файлы в Git: `git add .`
   - Сделайте первый коммит: `git commit -m "Initial commit"`
   - Отправьте код в репозиторий: `git push -u origin master`

3. **Деплой на Vercel**:
   - Зарегистрируйтесь на [Vercel](https://vercel.com/)
   - Нажмите "Add New..." > "Project"
   - Выберите свой GitHub репозиторий
   - Настройте проект:
     - Framework Preset: Other
     - Root Directory: ./
     - Build Command: (оставьте пустым)
     - Output Directory: (оставьте пустым)
   - Добавьте переменные окружения:
     - FIRECRAWL_API_KEY: ваш API-ключ FireCrawl
     - GEMINI_API_KEY: ваш API-ключ Google Gemini
   - Нажмите "Deploy"

4. **Настройка автоматического деплоя**:
   - После первого деплоя Vercel автоматически настроит GitHub Webhook
   - Каждый новый коммит в репозиторий будет автоматически деплоиться на Vercel
   - Вы можете настроить предварительный просмотр для Pull Request в настройках проекта

5. **Доступ к приложению**:
   - После успешного деплоя вы получите URL для доступа к приложению (например, web-parser-app.vercel.app)
   - Приложение автоматически получит SSL-сертификат
   - Вы можете настроить собственный домен в настройках проекта

Более подробная информация о деплое и других вариантах доступна в файле [deployment-plan.md](deployment-plan.md).

## Изменения в рефакторинге

Основные улучшения, внесенные в рефакторинг:

1. **Модульная структура**: 
   - Разделены монолитные файлы на небольшие специализированные модули
   - Функциональность дерева URL разделена на логические компоненты
   - Улучшена организация кода с четкими модулями

2. **ES модули**: 
   - Использованы нативные ES модули для лучшей организации кода
   - Правильные импорты/экспорты функций между модулями
   - Ясная система зависимостей между модулями

3. **Улучшение кода**:
   - Добавлена документация функций (JSDoc)
   - Улучшены имена переменных и функций
   - Удалены дублирующиеся функции
   - Устранены побочные эффекты

4. **Обработка ошибок**:
   - Улучшена обработка невалидных URL
   - Добавлены проверки на существование объектов
   - Более информативные сообщения об ошибках

5. **Удаление ненужного кода**:
   - Убраны неиспользуемые функции и переменные
   - Очищены глобальные привязки к window
   - Удалены ненужные директории и файлы

### Конфигурация переменных окружения

Приложение использует следующие переменные окружения:

- FIRECRAWL_API_KEY: ваш API-ключ Firecrawl
- GEMINI_API_KEY: ваш API-ключ Google Gemini

Вы можете настроить их:

1. В файле `.env` для локальной разработки
2. В панели управления Render.com для production-окружения
